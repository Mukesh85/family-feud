// Forked from https://codepen.io/MacEvelly/pen/rLWeYP
// Summary of 2017 Ember Community Survey https://www.emberjs.com/ember-community-survey-2017/
var emberQuestions = {
    "Name something you buy that is almost always white": [
        [
        "Underwear",
        18
        ],
        [
        "Toilet Paper",
        9
        ],
        [
        "Wedding Dress",
        9
        ],
        [
        "Milk",
        8
        ],
        [
        "Eggs",
        7
        ],
        [
        "Bread",
        6
        ],
        [
        "Sheets",
        6
        ],
        [
        "Flour",
        5
        ],
        [
        "Paper",
        5
        ],
        [
        "Sugar",
        3
        ],
        [
        "Tissues",
        3
        ],
        [
        "Socks",
        3
        ]
        ],
        "Name something people do when they have extra time in the morning": [
            [
            "Read",
            53
            ],
            [
            "Sleep",
            10
            ],
            [
            "Eat",
            9
            ],
            [
            "Exercise",
            8
            ],
            [
            "Watch TV",
            6
            ],
            [
            "Drink Coffee",
            5
            ],
            [
            "Clean",
            3
            ]
            ],
            "Name something people do to entertain a baby": [
                [
                "Sing",
                34
                ],
                [
                "Make Faces",
                23
                ],
                [
                "Play With It",
                9
                ],
                [
                "Talk To It",
                8
                ],
                [
                "Rock It",
                6
                ],
                [
                "Make Funny Noises",
                5
                ],
                [
                "Shake a Rattle",
                4
                ],
                [
                "Bounce",
                3
                ],
                [
                "Tickle",
                2
                ],
                [
                "Peek A Boo",
                2
                ]
                ],
                "Name something you don't do as much of in cold weather": [
                    [
                    "Garden",
                    26
                    ],
                    [
                    "Swimming",
                    24
                    ],
                    [
                    "Walk",
                    14
                    ],
                    [
                    "Cookout",
                    6
                    ],
                    [
                    "Sunbathing",
                    5
                    ],
                    [
                    "Bicycling",
                    4
                    ],
                    [
                    "Picnic",
                    3
                    ],
                    [
                    "Golf",
                    3
                    ]
                    ],
        "Name an occupation whose workers deal mostly with strangers": [
                        [
                        "Sales Clerk",
                        33
                        ],
                        [
                        "Police",
                        14
                        ],
                        [
                        "Flight Attendant",
                        7
                        ],
                        [
                        "Waiter",
                        6
                        ],
                        [
                        "Telephone Operator",
                        5
                        ],
                        [
                        "Hotel Clerk",
                        4
                        ],
                        [
                        "Banker",
                        3
                        ],
                        [
                        "Nurse",
                        3
                        ]
                        ],
                        "Name something people put oil on": [
                            [
                            "Body",
                            52
                            ],
                            [
                            "Salad",
                            30
                            ],
                            [
                            "Frying Pan",
                            4
                            ],
                            [
                            "Door Hinges",
                            3
                            ],
                            [
                            "Hair",
                            3
                            ],
                            [
                            "Furniture",
                            2
                            ]
                            ],
                            "Name an occupation whose people have big egos": [
                                [
                                "Actor",
                                30
                                ],
                                [
                                "Attorney",
                                23
                                ],
                                [
                                "Physician",
                                9
                                ],
                                [
                                "Politician",
                                8
                                ],
                                [
                                "Pro Athlete",
                                7
                                ],
                                [
                                "Model",
                                6
                                ],
                                [
                                "Business",
                                4
                                ],
                                [
                                "Police",
                                3
                                ],
                                [
                                "Musician",
                                2
                                ]
                                ],
                                "Name something you'd cry over losing": [
                                    [
                                    "Wedding Ring",
                                    41
                                    ],
                                    [
                                    "Loved One",
                                    22
                                    ],
                                    [
                                    "Pet",
                                    9
                                    ],
                                    [
                                    "Wallet",
                                    7
                                    ],
                                    [
                                    "Home",
                                    4
                                    ],
                                    [
                                    "Job",
                                    4
                                    ],
                                    [
                                    "Purse",
                                    3
                                    ]
                                    ],
                                    "Tell me a food people eat and then regret later": [
                                        [
                                        "Onions",
                                        20
                                        ],
                                        [
                                        "Chili",
                                        17
                                        ],
                                        [
                                        "Beans",
                                        14
                                        ],
                                        [
                                        "Ice Cream",
                                        6
                                        ],
                                        [
                                        "Peppers",
                                        6
                                        ],
                                        [
                                        "Pizza",
                                        6
                                        ],
                                        [
                                        "Cake",
                                        5
                                        ],
                                        [
                                        "Cabbage",
                                        5
                                        ],
                                        [
                                        "Chocolate",
                                        4
                                        ],
                                        [
                                        "Cucumbers",
                                        4
                                        ],
                                        [
                                        "Tacos",
                                        3
                                        ],
                                        [
                                        "Garlic",
                                        2
                                        ]
                                        ],
                                        "Name something women find hard to resist": [
                                            [
                                            "Shopping",
                                            27
                                            ],
                                            [
                                            "Candy",
                                            20
                                            ],
                                            [
                                            "Men",
                                            17
                                            ],
                                            [
                                            "Jewelry",
                                            13
                                            ],
                                            [
                                            "Clothes",
                                            10
                                            ],
                                            [
                                            "Gossip",
                                            2
                                            ],
                                            [
                                            "Money",
                                            2
                                            ]
                                            ],
                                            "Tell us something a mother says to her child over and over again": [
                                                [
                                                "No",
                                                30
                                                ],
                                                [
                                                "Don't",
                                                15
                                                ],
                                                [
                                                "I Love You",
                                                10
                                                ],
                                                [
                                                "Be Quiet",
                                                8
                                                ],
                                                [
                                                "Clean Your Room",
                                                7
                                                ],
                                                [
                                                "Don't Touch",
                                                7
                                                ],
                                                [
                                                "Brush Teeth",
                                                3
                                                ],
                                                [
                                                "Wash Hand",
                                                2
                                                ]
                                                ],
                                                "Name something that easy to do forwards, but hard backwards": [
                                                    [
                                                    "Walk",
                                                    24
                                                    ],
                                                    [
                                                    "Run",
                                                    19
                                                    ],
                                                    [
                                                    "Drive",
                                                    14
                                                    ],
                                                    [
                                                    "Write",
                                                    11
                                                    ],
                                                    [
                                                    "Skate",
                                                    10
                                                    ],
                                                    [
                                                    "Ride Bicycle",
                                                    9
                                                    ],
                                                    [
                                                    "Talk",
                                                    4
                                                    ]
                                                    ]
    
  };

  var app = {
    version: 1,
    currentQ: 0,
    jsonFile:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/40041/FF3.json",
    strikeCount: 0,
    board: $("<div class='gameBoard'>"+

               "<!--- Scores --->"+
               "<div class='score' id='boardScore'>0</div>"+
               "<div class='score' id='team1' >0</div>"+
               "<div class='score' id='team2' >0</div>"+

               "<!--- Question --->"+
               "<div class='questionHolder'>"+
                 "<span class='question'></span>"+
               "</div>"+

               "<!--- Answers --->"+
               "<div class='colHolder'>"+
                 "<div class='col1'></div>"+
                 "<div class='col2'></div>"+
               "</div>"+
               "<!--- Strikes --->" +
               "<div class='strike_cntr'>" +
                "<div class='strike_wrap'>" +
                "</div>" +
                "</div>" +
               "<!--- Buttons --->"+
               "<div class='btnHolder'>"+
                 "<div id='awardTeam1' data-team='1' class='button'>Award Team 1</div>"+
                 "<div id='newQuestion' class='button'>New Question</div>"+
                 "<div id='no' class='button'>Wrong</div>"+

                 "<div id='awardTeam2' data-team='2'class='button'>Award Team 2</div>"+
               "</div>"+

             "</div>"),
    // Utility functions
    shuffle: function(array){
      var currentIndex = array.length, temporaryValue, randomIndex;
      while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }
      return array;
    },
    jsonLoaded: function(data){
      console.clear()
      app.allData   = data
      app.questions = Object.keys(data)
      //app.shuffle(app.questions)
      app.makeQuestion(app.currentQ)
      $('body').append(app.board)
    },
    // Action functions
    makeQuestion: function(qNum){
      var qText  = app.questions[qNum]
      var qAnswr = app.allData[qText]

      var qNum = qAnswr.length
          qNum = (qNum<8)? 8: qNum;
          qNum = (qNum % 2 != 0) ? qNum+1: qNum;

      var boardScore = app.board.find("#boardScore")
      var question   = app.board.find(".question")
      var col1       = app.board.find(".col1")
      var col2       = app.board.find(".col2")

      boardScore.html(0)
      question.html(qText.replace(/&x22;/gi,'"'))
      col1.empty()
      col2.empty()

      for (var i = 0; i < qNum; i++){
        var aLI
        if(qAnswr[i]){
          aLI = $("<div class='cardHolder'>"+
                    "<div class='card'>"+
                      "<div class='front'>"+
                        "<span class='DBG'>"+(i+1)+"</span>"+
                      "</div>"+
                      "<div class='back DBG'>"+
                        "<span>"+qAnswr[i][0]+"</span>"+
                        "<b class='LBG'>"+qAnswr[i][1]+"</b>"+
                      "</div>"+
                    "</div>"+
                  "</div>")
        } else {
          aLI = $("<div class='cardHolder empty'><div></div></div>")
        }
        var parentDiv = (i<(qNum/2))? col1: col2;
        $(aLI).appendTo(parentDiv)
      }

      var cardHolders = app.board.find('.cardHolder')
      var cards       = app.board.find('.card')
      var backs       = app.board.find('.back')
      var cardSides   = app.board.find('.card>div')

      TweenLite.set(cardHolders , {perspective:800});
      TweenLite.set(cards       , {transformStyle:"preserve-3d"});
      TweenLite.set(backs       , {rotationX:180});
      TweenLite.set(cardSides   , {backfaceVisibility:"hidden"});

      cards.data("flipped", false)

      function showCard(){
        var card = $('.card', this)
        var flipped = $(card).data("flipped")
        var cardRotate = (flipped)?0:-180;
        TweenLite.to(card, 1, {rotationX:cardRotate, ease:Back.easeOut})
        flipped = !flipped
        $(card).data("flipped", flipped)
        app.playRight()
        app.getBoardScore()
      }
      cardHolders.on('click',showCard)
    },
    getBoardScore: function(){
      var cards = app.board.find('.card')
      var boardScore = app.board.find('#boardScore')
      var currentScore = {var: boardScore.html()}
      var score = 0
      function tallyScore(){
        if($(this).data("flipped")){
           var value = $(this).find("b").html()
           score += parseInt(value)
        }
      }
      $.each(cards, tallyScore)
      TweenMax.to(currentScore, 1, {
        var: score,
        onUpdate: function () {
          boardScore.html(Math.round(currentScore.var));
        },
        ease: Power3.easeOut,
      });
    },
    awardPoints: function(num){
      var num          = $(this).attr("data-team")
      var boardScore   = app.board.find('#boardScore')
      var currentScore = {var: parseInt(boardScore.html())}
      var team         = app.board.find("#team"+num)
      var teamScore    = {var: parseInt(team.html())}
      var teamScoreUpdated = (teamScore.var + currentScore.var)
      TweenMax.to(teamScore, 1, {
        var: teamScoreUpdated,
        onUpdate: function () {
          team.html(Math.round(teamScore.var));
        },
        ease: Power3.easeOut,
      });

      TweenMax.to(currentScore, 1, {
        var: 0,
        onUpdate: function () {
          boardScore.html(Math.round(currentScore.var));
        },
        ease: Power3.easeOut,
      });
    },
    changeQuestion: function(){
      app.currentQ++
      app.makeQuestion(app.currentQ)
    },
    playRight() {
      document.getElementById('right').play()
    },
     playWrong() {
         let strikes = app.board.find('.strike_wrap')
         let strike = $('<div class="strike"></div>')

         if(app.strikeCount < 3) {
             app.strikeCount += 1;
             strike.appendTo(strikes);
             strikes.css('opacity', 1);
             strikes.animate({opacity: 0}, 2000)
             document.getElementById('wrong').play()
         }


    },
    // Inital function
    init: function(){
      app.jsonLoaded(emberQuestions);
      //$.getJSON(app.jsonFile, app.jsonLoaded)
      app.board.find('#newQuestion' ).on('click', app.changeQuestion);
      app.board.find('#awardTeam1'  ).on('click', app.awardPoints);
      app.board.find('#awardTeam2'  ).on('click', app.awardPoints);
      $('#no').on('click', app.playWrong)
    }
    
  };
var fbApp = firebase.initializeApp(firebaseConfig);
app.init();
  //http://www.qwizx.com/gssfx/usa/ff.htm
